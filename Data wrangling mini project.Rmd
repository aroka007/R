---
title: "Data Wrangling Mini-Project"
author: "Adhiraj Roka"
date: "12/13/2019"
output: word_document
---

```{r setup, include=FALSE, warning=F, message=F}
library(tidyverse)
library(ggthemes)
library(readr)
library(lubridate)
library(forcats)
library(Amelia)
library(rvest)
library(xml2)
library(fBasics)
library(ggrepel)
```
1.a)
```{r}
shoot<-read_csv("fatal-police-shootings-data.csv", 
                col_names=TRUE, na=c(".", "NA", "", "?"))
#glimpse(shoot)
#Check missing values
missmap(shoot) #Variables race, armed, flee and age having missing values.


#Date
#reorder(month(shoot$date,label=T))

#Months
shoot %>% 
  ggplot(aes(fct_infreq(month(date,label=T))))+
  geom_bar(fill="cornflowerblue",color="black")+theme_economist()+
  labs(title = "Bar Plot of Date(in months)",x="Months",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count',aes(label=..count..),
            vjust = 1.45,color="floralwhite")

#March had the highest count of 458 and December had the lowest count of 336.
#Weekdays
shoot %>% 
  ggplot(aes(fct_infreq(wday(date,label=T))))+
  geom_bar(fill="lawngreen",color="black")+theme_economist()+
  labs(title = "Bar Plot of Date(in weekdays)",x="Weekdays",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            vjust = 1.45,color="black")

#Wednesday had the highest count of 740 and saturday had the lowest count of 641.

#Manner of Death
shoot %>% 
  ggplot(aes(manner_of_death))+
  geom_bar(fill="lemonchiffon1",color="black")+theme_economist()+
  labs(title = "Bar Plot of Manner of Death",
       x="Manner of Death",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            vjust = -0.1,color="black")
#Out of the 2 categories, manner of death=shot was the larger one.

#Armed
#Dropped NAs. Displayed only the top 20 categories with highest counts.
shoot %>% 
  drop_na(armed) %>% 
  group_by(armed) %>% 
  summarise(count=n()) %>% 
  arrange(desc(count)) %>% 
  slice(1:20) %>% 
  ggplot(aes(reorder(armed,count),count))+
  geom_col(fill="hotpink",color="black")+theme_economist()+
  labs(title = "Bar Plot of Armed",
       x="Armed",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  coord_flip()
#Clearly out of all the categories, gun has the highest count, followed by knife. Most of the categories only have a count of one.

#summary(as.factor(shoot$armed))
#count(shoot$gender,summary)

#Age 
shoot %>% 
  ggplot(aes(age))+
  geom_histogram(fill="orangered",color="black")+
  theme_economist()+
  labs(title = "Histogram of Age",
       x="Age",y="Count")+
  theme(plot.title = element_text(hjust = .5))+geom_vline(aes(xintercept=mean(age, na.rm=T)),   
            color="blue", linetype="dashed", size=1) #blue vertical line is mean age

boxplot(shoot$age, plot=T,col = "orangered")$out
skewness(shoot$age,na.rm = T)
#Age is positively skewed. It has outliers which are possibly making the right tail longer.

```


```{r}

#Gender
shoot%>% 
  ggplot(aes(fct_infreq(gender)))+
  geom_bar(fill="lightseagreen",color="black")+theme_economist()+
  labs(title = "Bar Plot of Gender",
       x="Gender",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            vjust =-.123,color="black")
#Males are shot the most. 4 missing values. Could possibly remove them later.

#Race
shoot%>% 
  ggplot(aes(fct_infreq(race)))+
  geom_bar(fill="mediumorchid1",color="black")+theme_economist()+
  labs(title = "Bar Plot of Race",
       x="Race",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            vjust =-.123,color="black")
#White race has the highest count. 528 NAs in this variable.

#State
shoot%>% 
  ggplot(aes(fct_infreq(state)))+
  geom_bar(fill="gold",color="black")+theme_economist()+
  labs(title = "Bar Plot of State",
       x="State",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            hjust =-.15,color="black")+coord_flip()
#California has the highest count of 725 followed by Texas of 424, and Rhode island has the lowest of 4.


#Signs of mental illness
shoot%>% 
  ggplot(aes((signs_of_mental_illness)))+
  geom_bar(fill="sienna3",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of Sign of Mental Illness",
       x="Signs of Mental Illness",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            vjust =1.2,color="floralwhite")
#Most of the people who were shot did not have signs of mental illness.


#Threat Level
shoot%>% 
  ggplot(aes(fct_infreq(threat_level)))+
  geom_bar(fill="slategray",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of Threat Level",
       x="Threat Level",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            vjust =1.2,color="floralwhite")
#Attack had the highest count (3062) and undetermined had the lowest.
```

```{r}

#Flee
shoot%>% 
  ggplot(aes(fct_infreq(flee)))+
  geom_bar(fill="yellow1",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of Fleeing",
       x="Fleeing",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            vjust =0.167,color="black")
#Not fleeing had highest count. Others had the lowest count. 208 missing values in this variable.

#Body Camera
shoot%>% 
  ggplot(aes((body_camera)))+
  geom_bar(fill="slateblue4",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of Body Camera",
       x="Body Camera",y="Count")+
  theme(plot.title = element_text(hjust = .5))+
  geom_text(stat = 'count', aes(label=..count..),
            vjust =1.2,color="floralwhite")
#Body camera was not present in the most of the cases.
```
b)
I chose age, gender, signs of mental illness and race to see how they were related to Threat Level.
```{r}
#3 variables: threat level ,race and signs of mental illness
shoot%>%
  drop_na(race) %>% 
  ggplot(aes(threat_level))+
  geom_bar(aes(fill=race),position="stack")+
  labs(title = "Bar Plot of Threat level and race",
       x="Threat level",y="Count")+
  theme(plot.title = element_text(hjust = .5))+facet_wrap(~signs_of_mental_illness)+
  scale_fill_discrete(name = "Race:")
#Shooting involving attacking white race, who do not have any mental illness is the most. This is also the case for different threat levels and for people having mental illness. Asians in all 3 threat level categories and mental illness categories have the lowest counts.

shoot%>% 
  drop_na(gender) %>% 
  ggplot(aes(threat_level))+
  geom_bar(aes(fill=gender))+
  labs(title = "Bar Plot of Threat level and Gender",
       x="Threat level",y="Count")+
  theme(plot.title = element_text(hjust = .5))+theme_bw()+
  scale_fill_discrete(name = "Gender")
#Males have the highest count in all threat levels.

#3 variables: threat level ,age and gender
shoot%>% 
  drop_na(age,gender) %>% 
  ggplot(aes(threat_level,age))+
  geom_violin(trim=FALSE,aes(col=threat_level))+ 
  scale_color_discrete(guide=FALSE)+
  geom_boxplot(aes(fill=gender),width=0.2)+
  theme_economist()+
  labs(title = "Boxplot of Age vs Threat level",
       x="Threat level",y="Age")+
  theme(plot.title = element_text(hjust = .5))+
  scale_fill_discrete(name = "Gender")
#For attack threat level, females have higher median age compared to males. However, for threat level other and undetermined, males have higher median age.

#by(shoot$threat_level,shoot$gender,summary)
```

c) I chose the second graph from part b) to see gender,race relationship to threat level.
```{r}
shoot%>% 
  drop_na(gender,race) %>% 
  ggplot(aes(threat_level))+
  geom_bar(aes(fill=gender))+
  labs(title = "Bar Plot of Threat level and Gender by Race",
       x="Threat level",y="Count")+
  theme(plot.title = element_text(hjust = .5))+theme_bw()+
  scale_fill_discrete(name = "Gender")+facet_grid(.~race)+coord_flip()

#Male and Race=white has the highest threat level(in all 3 categories). Similarly asian male have lowest count in all threat level categories.
```


2.
```{r}
#summary(as.factor(shoot$state))
#head(shoot$state)
shoot$race<-as.factor(shoot$race)
shoot$flee<-as.factor(shoot$flee)

### I dropped NA's from race,state,flee down here ###
shoot_state<-shoot%>% 
  drop_na(state,race,flee) %>% 
  group_by(state) %>% 
  summarise(Number_Shootings=n(),Median_Age=median(age,na.rm = T),
            White.prop=sum(race=="W")/n(),
            Flee.prop=sum(flee %in% c("Car","Foot","Other")/n()))  

#5 Highest count and 5 lowest counts displayed for each graph

  #No. of shooting
  shoot_state %>% arrange(desc(Number_Shootings)) %>% 
  slice(1:5,47:51)%>% 
  ggplot(aes(reorder(state,-Number_Shootings),Number_Shootings))+
  geom_col(fill="palegreen",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of Number of Shootings",
       y="Number of Shootings",x="State")+
  theme(plot.title = element_text(hjust = .5))
  #California has highest number of shootings and Rhode island has the least.
  
           
 #Median
  shoot_state %>% arrange(desc(Median_Age)) %>% 
  slice(1:5,47:51)%>% 
  ggplot(aes(reorder(state,-Median_Age),Median_Age))+
  geom_col(fill="orange2",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of Median Age",
       y="Median Age",x="State")+
  theme(plot.title = element_text(hjust = .5))
#New Hampshire , Vermont and Wyoming have highest median age and delaware has the lowest meadian age.
  
#White proportion
  shoot_state %>% arrange(desc(White.prop)) %>% 
  slice(1:5,47:51)%>% 
  ggplot(aes(reorder(state,-White.prop),White.prop))+
  geom_col(fill="royalblue3",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of White proportion",
       y="White proportion",x="State")+
  theme(plot.title = element_text(hjust = .5))
#New Hampshire had highest White proportion and DC had the least.
  
#Flee proportion
  shoot_state %>% arrange(desc(Flee.prop)) %>% 
  slice(1:5,47:51)%>% 
  ggplot(aes(reorder(state,-Flee.prop),Flee.prop))+
  geom_col(fill="orange2",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of Fleeing",
       y="Fleeing",x="State")+
  theme(plot.title = element_text(hjust = .5))
#Rhode Island had the highest proportion of victims who were fleeing and Maine had the least.

# Proportion of victims that were White vs. the proportion of victims
#who were fleeing
 shoot_state %>%
  ggplot(aes(White.prop,Flee.prop))+
  geom_point(col="red2")+
  geom_label_repel(aes(label =
                         ifelse(Flee.prop<.2|Flee.prop>.8,as.character(state),'')),
                  box.padding   = 0.35, 
                  point.padding = 0.5,
                  segment.color = 'grey50')+
  theme_clean()+
  labs(title = "Fleeing vs White",x="Proportion of White",y="Proportion of Fleeing")+
  theme(plot.title = element_text(hjust = .5))+
   geom_smooth(method="lm",se=F,color="darkorchid3",lty=2) 
  
```
The scatterplot has a negative relationship. As the proportion of white victims increases the proportion of fleeing goes down. Rhode island seems to be an outlier here as proportion of fleeing went up as proportion of white victims increased.

3.
```{r}
#a)
pop.url<-"https://simple.wikipedia.org/wiki/List_of_U.S._states_by_population"
statepop<- pop.url %>% read_html() %>%
  html_nodes("table") %>% .[[1]] %>%
  html_table() %>% select(3,4) %>%
  as_tibble()

names(statepop)<- c("state","Pop.2019")

#b)
state_pop<-statepop %>% 
  mutate(Pop.mill=as.numeric(str_remove_all(Pop.2019,","))/1000000) %>% 
  select(-Pop.2019) %>% slice(-c(53:60)) #remove unneeded rows 

#c), d)

#Add DC

# name=state.name[-c(52:53)]
# abb=state.abb[-c(52)]
a=data.frame(state.name,state.abb)

state_merge<-state_pop %>% 
  inner_join(a,by=c("state"="state.name"))
#setdiff(shoot_state$state,state_merge$state.abb) #to see the difference

#e)
state_pop2<- statepop %>% 
  inner_join(state_merge,by="state")

#f.
shoot_state_pop<-
shoot_state %>% 
  inner_join(state_pop2,by=c("state"="state.abb"))

#g) Rate per million
shoot_state_pop<- shoot_state_pop %>% 
  mutate(Rate=Number_Shootings/Pop.mill)

#h)
#Rate BarGraph 
shoot_state_pop %>% arrange(desc(Rate)) %>% 
  slice(1:5,47:51)%>% 
  ggplot(aes(reorder(state,-Rate),Rate))+
  geom_col(fill="palegreen",color="black")+
  theme_economist()+
  labs(title = "Bar Plot of Shooting Rate",
       y="Shooting Rate",x="State")+
  theme(plot.title = element_text(hjust = .5))

```
Yes the graphs have changed. Before california had the most number of shootings but now, New Mexico has the most rate of shootings. However, Rhode Island is at the bottom of both the number of shootings and shooting rate.


4.
```{r}
#a)
 race.wiki<-"https://en.wikipedia.org/wiki/Demography_of_the_United_States" %>%
  read_html()%>%
  html_nodes("table") %>% .[[26]] %>%
  html_table() %>% 
  as_tibble()

#b)
race.wiki<-race.wiki %>% 
  mutate(White=as.numeric(str_remove_all(White,"%"))/100)

#c)

shoot_state_pop_w<-shoot_state_pop %>% 
  inner_join(race.wiki, by=c("state.y"="State or territory"))

#d)

shoot_state_pop_w %>% 
  ggplot(aes(White, White.prop))+
  geom_point(col="violetred")+
  geom_label_repel(aes(label = ifelse(White.prop<.2|White.prop>.8,as.character(state),'')),
                  box.padding   = 0.35, 
                  point.padding = 0.5,
                  segment.color = 'grey50')+
                  theme_economist()+
  labs(title = "White victims vs White population per state",x="Proportion of White population",y="Proportion of White victims")+
  theme(plot.title = element_text(hjust = .5))+
  geom_smooth(method="lm",se=F,color="darkorchid3",lty=2) 
```
Proportion of White population per state and proportion of white victims per state are positively correlated. As proportion of white population increases, proportion of white victims also increases.Possible 2 outliers in the beginning of the graph (DC and Hawaii). Other 5 state names displayed in the graph are proportion of white victims greater than 0.8.
